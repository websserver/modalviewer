<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Visualizador 3D AR</title>
    
    <!-- Model Viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Equipamentos de tabaco aquecido</h1>
        
        <!-- Seletor de Modelos -->
        <div class="model-selector">
            <button class="model-button active" data-model="iprimeaqua_1">IQOS ILUMA</button>
            <button class="model-button" data-model="iprimeaqua_2">IQOS ILUMA ONE</button>
            <button class="model-button" data-model="iprimeaqua_3">IQOS ILUMA PRIME</button>
        </div>
        
        <!-- Mensagem de erro -->
        <div id="error-message" class="error-message" style="display: none;">
            <p>Ocorreu um erro ao carregar o modelo. Por favor, tente novamente.</p>
        </div>

        <!-- Painel de informa√ß√µes dos hotspots -->
        <div id="hotspot-info" class="hotspot-info" style="display: none;">
            <button class="close-button" onclick="closeHotspotInfo()">√ó</button>
            <h2 id="hotspot-title">T√≠tulo</h2>
            <p id="hotspot-description">Descri√ß√£o</p>
        </div>
        
        <!-- Bot√µes AR -->
        <div class="ar-buttons">
            <!-- Bot√£o AR para Android -->
            <button id="ar-button-android" class="ar-button" style="display: none;">
                Ver em AR
            </button>
            
            <!-- Bot√£o AR para iOS -->
            <button id="ar-button-ios" class="ar-button" style="display: none;">
                Abrir em AR (iOS)
            </button>
        </div>
        
        <model-viewer
            id="model-viewer"
            src="https://websserver.github.io/modalviewer/modelo3d/iprimeaqua_1.glb"
            ios-src="https://websserver.github.io/modalviewer/modelo3d/iprimeaqua_1.usdz"
            alt="Modelo 3D"
            ar
            ar-modes="webxr scene-viewer quick-look"
            camera-controls
            auto-rotate
            shadow-intensity="1"
            shadow-softness="1"
            exposure="1"
            interaction-prompt="none"
            ar-placement="floor"
            ar-scale="fixed"
            scale="1.5 1.5 1.5"
            min-camera-orbit="auto auto 5%"
            max-camera-orbit="auto auto 200%"
            loading="eager"
            style="width: 100%; height: 70vh; background-color: #ffffff;">

            <!-- Hotspots -->
            <button class="hotspot" slot="hotspot-1" data-position="0.1 0.2 0.1" data-normal="0 1 0" data-visibility-attribute="visible" style="transform: translate3d(0, 0, 0);" data-surface="front">
                <div class="hotspot-dot"></div>
                <div class="hotspot-label">Tela OLED</div>
            </button>

            <button class="hotspot" slot="hotspot-2" data-position="-0.1 0.15 0" data-normal="0 1 0" data-visibility-attribute="visible" style="transform: translate3d(0, 0, 0);" data-surface="front">
                <div class="hotspot-dot"></div>
                <div class="hotspot-label">Bateria</div>
            </button>

            <button class="hotspot" slot="hotspot-3" data-position="0 0.25 0.1" data-normal="0 1 0" data-visibility-attribute="visible" style="transform: translate3d(0, 0, 0);" data-surface="front">
                <div class="hotspot-dot"></div>
                <div class="hotspot-label">C√¢mara de Aquecimento</div>
            </button>

            <!-- Script para gerenciar hotspots -->
            <script>
                const modelViewer = document.querySelector('model-viewer');
                
                // Fun√ß√£o para garantir visibilidade dos hotspots
                function updateHotspotsVisibility() {
                    const hotspots = document.querySelectorAll('.hotspot');
                    hotspots.forEach(hotspot => {
                        hotspot.style.opacity = '1';
                        hotspot.style.visibility = 'visible';
                        hotspot.style.pointerEvents = 'auto';
                    });
                }

                // Atualizar hotspots quando o modelo carregar
                modelViewer.addEventListener('load', updateHotspotsVisibility);

                // Atualizar hotspots quando AR iniciar
                modelViewer.addEventListener('ar-status', (event) => {
                    if (event.detail.status === 'session-started') {
                        updateHotspotsVisibility();
                    }
                });

                // Atualizar hotspots durante o tracking AR
                modelViewer.addEventListener('ar-tracking', (event) => {
                    if (event.detail.status === 'tracking') {
                        updateHotspotsVisibility();
                    }
                });
            </script>

            <!-- Aviso AR -->
            <div class="ar-placement-prompt" slot="ar-prompt">
                Pouse o seu IQOS clicando no ecr√£
            </div>

            <!-- Instru√ß√µes AR -->
            <div class="ar-instructions" slot="ar-overlay">
                <div class="instruction-item">
                    <span class="instruction-icon">üëÜ</span>
                    <span>Toque para colocar o modelo</span>
                </div>
                <div class="instruction-item">
                    <span class="instruction-icon">‚úã</span>
                    <span>Arraste com um dedo para mover</span>
                </div>
                <div class="instruction-item">
                    <span class="instruction-icon">ü§è</span>
                    <span>Belisque para redimensionar</span>
                </div>
                <div class="instruction-item">
                    <span class="instruction-icon">‚Üª</span>
                    <span>Gire com dois dedos para rodar</span>
                </div>
            </div>

            <div class="progress-bar hide" slot="progress-bar">
                <div class="update-bar"></div>
            </div>

            <!-- Dicas de uso -->
            <div class="ar-prompt">
                <p id="ar-prompt-text">Carregando modelo...</p>
            </div>
        </model-viewer>

        <div class="controls">
            <button id="rotate-left">‚ü≤ Girar Esquerda</button>
            <button id="rotate-right">‚ü≥ Girar Direita</button>
            <button id="zoom-in">+ Aproximar</button>
            <button id="zoom-out">- Afastar</button>
        </div>
    </div>

    <script>
        // Dados dos hotspots
        const hotspotData = {
            'hotspot-1': {
                title: 'Tela OLED',
                description: 'Tela OLED de alta resolu√ß√£o que mostra o status do dispositivo, n√≠vel de bateria e configura√ß√µes.'
            },
            'hotspot-2': {
                title: 'Bateria',
                description: 'Bateria de longa dura√ß√£o que permite v√°rias sess√µes de uso. Recarreg√°vel via USB-C.'
            },
            'hotspot-3': {
                title: 'C√¢mara de Aquecimento',
                description: 'Tecnologia de aquecimento avan√ßada que garante uma experi√™ncia consistente.'
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            const modelViewer = document.querySelector('model-viewer');
            const arButtonAndroid = document.getElementById('ar-button-android');
            const arButtonIOS = document.getElementById('ar-button-ios');
            const errorMessage = document.getElementById('error-message');
            const arPromptText = document.getElementById('ar-prompt-text');
            const hotspotInfo = document.getElementById('hotspot-info');
            const hotspotTitle = document.getElementById('hotspot-title');
            const hotspotDescription = document.getElementById('hotspot-description');
            
            // Configurar seletor de modelos
            const modelButtons = document.querySelectorAll('.model-button');
            modelButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remover classe active de todos os bot√µes
                    modelButtons.forEach(btn => btn.classList.remove('active'));
                    // Adicionar classe active ao bot√£o clicado
                    button.classList.add('active');
                    
                    // Atualizar modelo
                    const modelName = button.getAttribute('data-model');
                    const modelUrl = `https://websserver.github.io/modalviewer/modelo3d/${modelName}.glb`;
                    const usdzUrl = `https://websserver.github.io/modalviewer/modelo3d/${modelName}.usdz`;
                    modelViewer.src = modelUrl;
                    modelViewer.iosSrc = usdzUrl;
                    
                    // Resetar c√¢mera
                    modelViewer.cameraOrbit = '0deg 75deg 105%';
                    modelViewer.fieldOfView = '30deg';
                });
            });
            
            // Configurar hotspots
            const hotspots = document.querySelectorAll('.hotspot');
            hotspots.forEach(hotspot => {
                hotspot.addEventListener('click', () => {
                    const slotName = hotspot.getAttribute('slot');
                    const data = hotspotData[slotName];
                    if (data) {
                        hotspotTitle.textContent = data.title;
                        hotspotDescription.textContent = data.description;
                        hotspotInfo.style.display = 'block';
                    }
                });
            });

            // Adicionar evento para mostrar coordenadas do clique
            modelViewer.addEventListener('click', (event) => {
                const hit = modelViewer.positionAndNormalFromPoint(event.clientX, event.clientY);
                if (hit) {
                    console.log('Posi√ß√£o do clique:', hit.position);
                }
            });

            // Fechar painel de informa√ß√µes
            window.closeHotspotInfo = function() {
                hotspotInfo.style.display = 'none';
            };
            
            // Detectar dispositivo
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isAndroid = /Android/i.test(navigator.userAgent);
            
            // Configurar bot√µes AR baseado no dispositivo
            if (isIOS) {
                arButtonIOS.style.display = 'block';
                arButtonAndroid.style.display = 'none';
                arPromptText.textContent = 'Toque no bot√£o para iniciar AR';
                
                arButtonIOS.addEventListener('click', function() {
                    // Criar link AR diretamente
                    const anchor = document.createElement('a');
                    anchor.setAttribute('rel', 'ar');
                    const activeButton = document.querySelector('.model-button.active');
                    const modelName = activeButton.getAttribute('data-model');
                    const modelUrl = `https://websserver.github.io/modalviewer/modelo3d/${modelName}.usdz`;
                    anchor.setAttribute('href', modelUrl);
                    
                    // Mostrar lista de caracter√≠sticas
                    const iosFeatures = document.getElementById('ios-features');
                    if (iosFeatures) {
                        iosFeatures.style.position = 'fixed';
                        iosFeatures.style.bottom = '20px';
                        iosFeatures.style.left = '50%';
                        iosFeatures.style.transform = 'translateX(-50%)';
                        iosFeatures.style.zIndex = '9999';
                        iosFeatures.style.display = 'block';
                        iosFeatures.style.width = '90%';
                        iosFeatures.style.maxWidth = '400px';
                        iosFeatures.style.background = 'rgba(255, 255, 255, 0.95)';
                    }
                    
                    // Iniciar experi√™ncia AR
                    anchor.click();
                });
            } else if (isAndroid) {
                arButtonAndroid.style.display = 'block';
                arButtonIOS.style.display = 'none';
                arPromptText.textContent = 'Toque no bot√£o para iniciar AR';
                
                // Configurar bot√£o AR para Android
                arButtonAndroid.addEventListener('click', function() {
                    modelViewer.activateAR();
                });
            }

            // Verificar suporte a AR e configurar eventos
            if (modelViewer) {
                modelViewer.addEventListener('ar-status', (event) => {
                    const arInstructions = document.querySelector('.ar-instructions');
                    
                    if (event.detail.status === 'failed') {
                        console.error('Falha ao iniciar AR:', event.detail.error);
                        errorMessage.style.display = 'block';
                        errorMessage.querySelector('p').textContent = 
                            'N√£o foi poss√≠vel iniciar o AR. Verifique se seu dispositivo suporta AR.';
                        if (arInstructions) {
                            arInstructions.style.display = 'none';
                        }
                    } else if (event.detail.status === 'session-started') {
                        console.log('Sess√£o AR iniciada');
                        if (arInstructions) {
                            arInstructions.style.display = 'flex';
                            arInstructions.style.opacity = '1';
                            updateHotspotsVisibility(); // Garantir que os hotspots estejam vis√≠veis
                        }
                    }
                });

                // Atualizar visibilidade dos hotspots durante o tracking
                modelViewer.addEventListener('ar-tracking', (event) => {
                    if (event.detail.status === 'tracking') {
                        updateHotspotsVisibility();
                    }
                });
            }
        });
    </script>

    <!-- Lista de caracter√≠sticas para iOS -->
    <div id="ios-features" class="ios-features" style="display: none;">
        <h3>Caracter√≠sticas do Produto:</h3>
        <div class="feature-item">
            <div class="feature-icon">üì±</div>
            <div class="feature-text">
                <strong>Tela OLED</strong>
                <p>Tela OLED de alta resolu√ß√£o que mostra o status do dispositivo, n√≠vel de bateria e configura√ß√µes.</p>
            </div>
        </div>
        <div class="feature-item">
            <div class="feature-icon">üîã</div>
            <div class="feature-text">
                <strong>Bateria</strong>
                <p>Bateria de longa dura√ß√£o que permite v√°rias sess√µes de uso. Recarreg√°vel via USB-C.</p>
            </div>
        </div>
        <div class="feature-item">
            <div class="feature-icon">üî•</div>
            <div class="feature-text">
                <strong>C√¢mara de Aquecimento</strong>
                <p>Tecnologia de aquecimento avan√ßada que garante uma experi√™ncia consistente.</p>
            </div>
        </div>
    </div>
</body>
</html> 