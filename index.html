<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Visualizador 3D AR</title>
    
    <!-- Model Viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Modal de Verifica√ß√£o de Idade -->
    <div class="age-verification-modal" id="ageVerificationModal">
        <div class="age-verification-content">
            <img src="https://www.iqos.com/content/dam/iqos/pt/logo/iqos-logo.svg" alt="IQOS Logo" class="age-verification-logo">
            <p class="age-verification-title">
                Introduza a sua data de nascimento para confirmar que √© um utilizador adulto de produtos de tabaco ou nicotina.
            </p>
            <div class="age-selectors">
                <select class="age-select" id="monthSelect">
                    <option value="">M√äS *</option>
                </select>
                <select class="age-select" id="yearSelect">
                    <option value="">ANO *</option>
                </select>
            </div>
            <button class="age-verify-button" id="confirmAgeBtn" disabled>CONFIRMAR</button>
            <p class="age-verification-disclaimer">
                Este website cont√©m informa√ß√£o sobre os nossos produtos sem fumo. Precisamos de conhecer a sua idade para assegurar que √© um adulto que de outra forma continuaria a fumar ou a usar produtos com nicotina. Os nossos produtos sem fumo n√£o s√£o uma alternativa para deixar de fumar nem foram concebidos como meios de cessa√ß√£o. N√£o est√£o isentos de riscos, cont√™m nicotina que cria depend√™ncia e destinam-se exclusivamente a adultos.<br>
                Consulte a pagina de Informa√ß√£o Importante no site para mais informa√ß√£o sobre os riscos.
            </p>
        </div>
    </div>

    <header class="hero-header">
        <div class="hero-content">
            <H2>NOVO</H2>
            <h1 class="hero-title">IQOS ILUMA i PRIME</h1>
            <div class="hero-model">
                <model-viewer 
                    src="modelo3d/modelo.glb"
                    camera-controls
                    auto-rotate
                    rotation-per-second="30deg"
                    interaction-prompt="none"
                    shadow-intensity="1"
                    exposure="1.2"
                    loading-progress="manual"
                    preload
                    loading-mode="eager"
                    draco-decoder-path="https://www.gstatic.com/draco/versioned/decoders/1.5.6/"
                    style="width: 100%; height: 60vh; background-color: transparent;">
                </model-viewer>
            </div>
            <p class="hero-description">A inova√ß√£o atinge um novo patamar</p>
            <button class="cta-button" onclick="scrollToSelector()">EXPERI√äNCIA IMERSIVA</button>
        </div>
    </header>
    <div class="container">
        <h2 class="selector-title">ESCOLHE A M√ÅQUINA E VIVE UMA EXPERI√äNCIA IMERSIVA</h2>
        
        <!-- Seletor de Modelos -->
        <div id="model-selector" class="model-selector">
            <button class="model-button active" data-model="iprimeaqua_1">IQOS ILUMA</button>
            <button class="model-button" data-model="iprimeaqua_2">IQOS ILUMA ONE</button>
            <button class="model-button" data-model="iprimeaqua_3">IQOS ILUMA PRIME</button>
        </div>

        <!-- Bot√µes AR -->
        <div class="ar-buttons">
            <button id="ar-button-android" class="ar-button" style="display: none;">
                Experi√™ncia com Realidade Aumentada
            </button>
            <button id="ar-button-ios" class="ar-button" style="display: none;">
                Experi√™ncia com Realidade Aumentada
            </button>
        </div>

        <!-- Visualizador 3D -->
        <div class="model-container">
            <model-viewer
                id="model-viewer"
                src="modelo3d/iprimeaqua_1.glb"
                ios-src="modelo3d/iprimeaqua_1.usdz"
                alt="Modelo 3D"
                ar
                ar-modes="scene-viewer webxr quick-look"
                ar-scale="fixed"
                ar-placement="floor"
                camera-controls
                auto-rotate
                shadow-intensity="1"
                shadow-softness="0"
                exposure="1"
                environment-image="neutral"
                interaction-prompt="none"
                scale="7 7 7"
                min-camera-orbit="auto auto 5%"
                max-camera-orbit="auto auto 100%"
                camera-orbit="0deg 75deg 105%"
                loading="eager"
                loading-progress="none"
                preload
                loading-mode="eager"
                draco-decoder-path="https://www.gstatic.com/draco/versioned/decoders/1.5.6/"
                style="width: 100%; height: 100%; background-color: #ffffff;">

                <!-- Hotspots -->
                <button class="hotspot" slot="hotspot-1" data-position="0.1 0.2 0.1" data-normal="0 1 0" data-visibility-attribute="visible">
                    <div class="hotspot-dot"></div>
                    <div class="hotspot-label">Tela OLED</div>
                </button>

                <button class="hotspot" slot="hotspot-2" data-position="-0.1 0.15 0" data-normal="0 1 0" data-visibility-attribute="visible">
                    <div class="hotspot-dot"></div>
                    <div class="hotspot-label">Bateria</div>
                </button>

                <button class="hotspot" slot="hotspot-3" data-position="0 0.25 0.1" data-normal="0 1 0" data-visibility-attribute="visible">
                    <div class="hotspot-dot"></div>
                    <div class="hotspot-label">C√¢mara de Aquecimento</div>
                </button>

                <!-- Aviso AR -->
                <div class="ar-placement-prompt" slot="ar-prompt">
                    Pouse o seu IQOS clicando no ecr√£
                </div>

                <!-- Instru√ß√µes AR -->
                <div class="ar-instructions" slot="ar-overlay">
                    <div class="instruction-item">
                        <span class="instruction-icon">üëÜ</span>
                        <span>Toque para colocar o modelo</span>
                    </div>
                    <div class="instruction-item">
                        <span class="instruction-icon">‚úã</span>
                        <span>Arraste com um dedo para mover o modelo</span>
                    </div>
                    <div class="instruction-item">
                        <span class="instruction-icon">‚Üª</span>
                        <span>Gire com dois dedos para rodar</span>
                    </div>
                </div>

                <div class="progress-bar hide" slot="progress-bar">
                    <div class="update-bar"></div>
                </div>
            </model-viewer>

            <div class="controls">
                <button id="rotate-left" title="Girar Esquerda">‚Ü∫</button>
                <button id="rotate-right" title="Girar Direita">‚Üª</button>
                <button id="zoom-in" title="Aproximar">+</button>
                <button id="zoom-out" title="Afastar">‚àí</button>
            </div>
        </div>

        <div class="ar-modal" id="arModal">
            <div class="ar-modal-content">
                <h2>Como usar a Realidade Aumentada</h2>
                <div class="ar-instructions-list">
                    <div class="instruction-item">
                        <span class="instruction-icon">üëÜ</span>
                        <span>Toque para colocar o modelo</span>
                    </div>
                    <div class="instruction-item">
                        <span class="instruction-icon">‚úã</span>
                        <span>Arraste com um dedo para mover o modelo</span>
                    </div>
                    <div class="instruction-item">
                        <span class="instruction-icon">‚Üª</span>
                        <span>Gire com dois dedos para rodar</span>
                    </div>
                    <div class="instruction-item">
                        <span class="instruction-icon">üìç</span>
                        <span>O modelo ficar√° fixo onde foi colocado. Se mover a c√¢mera para longe, volte ao local inicial ou feche e abra novamente para reposicionar</span>
                    </div>
                </div>
                <button id="startAR" class="ar-start-button">Iniciar Experi√™ncia AR</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p class="footer-warning">
            <b>ESTE PRODUTO N√ÉO √â ISENTO DE RISCO E CONT√âM NICOTINA, UMA SUBST√ÇNCIA QUE CRIA DEPEND√äNCIA. DESTINADO APENAS A FUMADORES ADULTOS.</b>
        </p>
        <p class="footer-copyright">
            ¬© 2025 Philip Morris Products SA. Todos os direitos reservados.
        </p>
    </footer>

    <script>
        // Verifica√ß√£o de Idade
        document.addEventListener('DOMContentLoaded', function() {
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const confirmBtn = document.getElementById('confirmAgeBtn');
            const modal = document.getElementById('ageVerificationModal');

            // Verificar se j√° foi verificado antes
            const ageVerified = localStorage.getItem('ageVerified');
            if (ageVerified === 'true') {
                modal.style.display = 'none';
            }

            // Preencher meses
            const months = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = month;
                monthSelect.appendChild(option);
            });

            // Preencher anos (√∫ltimos 120 anos)
            const currentYear = new Date().getFullYear();
            for (let year = currentYear; year >= currentYear - 120; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }

            // Fun√ß√£o para verificar idade
            function checkAge() {
                const month = parseInt(monthSelect.value);
                const year = parseInt(yearSelect.value);
                
                if (month && year) {
                    const birthDate = new Date(year, month - 1);
                    const today = new Date();
                    let age = today.getFullYear() - birthDate.getFullYear();
                    const m = today.getMonth() - birthDate.getMonth();
                    
                    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                        age--;
                    }
                    
                    confirmBtn.disabled = age < 18;
                } else {
                    confirmBtn.disabled = true;
                }
            }

            // Adicionar event listeners
            monthSelect.addEventListener('change', checkAge);
            yearSelect.addEventListener('change', checkAge);
            
            // Event listener para o bot√£o confirmar
            confirmBtn.addEventListener('click', function(event) {
                event.preventDefault();
                console.log('Bot√£o clicado');
                localStorage.setItem('ageVerified', 'true');
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });

            // Verifica√ß√£o inicial
            if (localStorage.getItem('ageVerified') === 'true') {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            } else {
                document.body.style.overflow = 'hidden';
            }
        });

        // Fun√ß√£o para scroll suave
        function scrollToSelector() {
            document.getElementById('model-selector').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Pr√©-carregar modelos
        const modelFiles = ['iprimeaqua_1', 'iprimeaqua_2', 'iprimeaqua_3'];
        const preloadedModels = new Map();

        async function preloadModels() {
            for (const modelName of modelFiles) {
                try {
                    const response = await fetch(`modelo3d/${modelName}.glb`);
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    preloadedModels.set(modelName, url);
                } catch (error) {
                    console.error(`Erro ao pr√©-carregar modelo ${modelName}:`, error);
                }
            }
        }

        // Iniciar pr√©-carregamento quando a p√°gina carregar
        window.addEventListener('load', preloadModels);

        document.addEventListener('DOMContentLoaded', function() {
            const modelViewer = document.querySelector('#model-viewer');
            const modelButtons = document.querySelectorAll('.model-button');
            const arButtonAndroid = document.getElementById('ar-button-android');
            const arButtonIOS = document.getElementById('ar-button-ios');
            
            // Detectar dispositivo
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isAndroid = /Android/i.test(navigator.userAgent);

            // Fun√ß√£o para ativar AR no Android
            async function activateARAndroid() {
                try {
                    await modelViewer.activateAR();
                } catch (error) {
                    console.error('Erro ao ativar AR:', error);
                    // Fallback para scene-viewer se webxr falhar
                    const modelName = modelViewer.src.split('/').pop().split('.')[0];
                    window.location.href = `intent://arvr.google.com/scene-viewer/1.0?file=${window.location.origin}/modelo3d/${modelName}.glb&mode=ar_preferred&resizable=false&scale=7.0#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=https://developers.google.com/ar;end;`;
                }
            }

            // Fun√ß√£o para ativar AR no iOS
            async function activateARiOS() {
                try {
                    const modelName = modelViewer.src.split('/').pop().split('.')[0];
                    window.location.href = `modelo3d/${modelName}.usdz`;
                } catch (error) {
                    console.error('Erro ao ativar AR no iOS:', error);
                }
            }

            // Configurar modal AR
            const arModal = document.getElementById('arModal');
            const startARButton = document.getElementById('startAR');

            function showARInstructions() {
                arModal.style.display = 'flex';
            }

            function hideARInstructions() {
                arModal.style.display = 'none';
            }

            startARButton.addEventListener('click', () => {
                hideARInstructions();
                activateARAndroid();
            });

            // Configurar bot√µes AR baseado no dispositivo
            if (isIOS) {
                arButtonIOS.style.display = 'block';
                arButtonAndroid.style.display = 'none';
                arButtonIOS.onclick = activateARiOS;
            } else if (isAndroid) {
                arButtonAndroid.style.display = 'block';
                arButtonIOS.style.display = 'none';
                arButtonAndroid.onclick = showARInstructions;
            }
            
            // Configurar seletor de modelos
            modelButtons.forEach(button => {
                button.addEventListener('click', async () => {
                    // Remover classe active de todos os bot√µes
                    modelButtons.forEach(btn => btn.classList.remove('active'));
                    // Adicionar classe active ao bot√£o clicado
                    button.classList.add('active');
                    
                    // Atualizar modelo usando o modelo pr√©-carregado se dispon√≠vel
                    const modelName = button.getAttribute('data-model');
                    if (preloadedModels.has(modelName)) {
                        modelViewer.src = preloadedModels.get(modelName);
                    } else {
                        modelViewer.src = `modelo3d/${modelName}.glb`;
                    }
                    modelViewer.iosSrc = `modelo3d/${modelName}.usdz`;
                    
                    // Mostrar bot√£o AR apropriado
                    if (isIOS) {
                        arButtonIOS.style.display = 'block';
                        arButtonIOS.onclick = () => {
                            window.location.href = `modelo3d/${modelName}.usdz`;
                        };
                    } else if (isAndroid) {
                        arButtonAndroid.style.display = 'block';
                        arButtonAndroid.onclick = showARInstructions;
                    }
                    
                    // Resetar c√¢mera
                    modelViewer.cameraOrbit = '0deg 75deg 105%';
                    modelViewer.fieldOfView = '30deg';
                });
            });

            // Configurar bot√µes de controle
            const rotateLeftBtn = document.getElementById('rotate-left');
            const rotateRightBtn = document.getElementById('rotate-right');
            const zoomInBtn = document.getElementById('zoom-in');
            const zoomOutBtn = document.getElementById('zoom-out');

            let currentRotation = 0;
            const rotationStep = 30;
            let currentZoom = 105;
            const zoomStep = 10;

            rotateLeftBtn.addEventListener('click', () => {
                currentRotation -= rotationStep;
                modelViewer.cameraOrbit = `${currentRotation}deg 75deg ${currentZoom}%`;
            });

            rotateRightBtn.addEventListener('click', () => {
                currentRotation += rotationStep;
                modelViewer.cameraOrbit = `${currentRotation}deg 75deg ${currentZoom}%`;
            });

            zoomInBtn.addEventListener('click', () => {
                currentZoom = Math.max(currentZoom - zoomStep, 50);
                modelViewer.cameraOrbit = `${currentRotation}deg 75deg ${currentZoom}%`;
            });

            zoomOutBtn.addEventListener('click', () => {
                currentZoom = Math.min(currentZoom + zoomStep, 150);
                modelViewer.cameraOrbit = `${currentRotation}deg 75deg ${currentZoom}%`;
            });

            // Atualizar hotspots quando o modelo carregar
            modelViewer.addEventListener('load', () => {
                const hotspots = document.querySelectorAll('.hotspot');
                hotspots.forEach(hotspot => {
                    hotspot.style.opacity = '1';
                    hotspot.style.visibility = 'visible';
                });
            });
        });
    </script>
</body>
</html> 