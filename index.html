<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Visualizador 3D AR</title>
    
    <!-- Model Viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Visualizador 3D em AR</h1>
        
        <!-- Mensagem de erro -->
        <div id="error-message" class="error-message" style="display: none;">
            <p>Ocorreu um erro ao carregar o modelo. Por favor, tente novamente.</p>
        </div>

        <!-- Painel de informações dos hotspots -->
        <div id="hotspot-info" class="hotspot-info" style="display: none;">
            <button class="close-button" onclick="closeHotspotInfo()">×</button>
            <h2 id="hotspot-title">Título</h2>
            <p id="hotspot-description">Descrição</p>
        </div>
        
        <!-- Botão AR Personalizado para iOS -->
        <button id="ar-button-ios" class="ar-button" style="display: none;">
            Abrir em AR (iOS)
        </button>
        
        <model-viewer
            src="https://websserver.github.io/modalviewer/modelo3d/modelo.glb"
            ios-src="https://websserver.github.io/modalviewer/modelo3d/modelo.usdz"
            alt="Modelo 3D"
            ar
            ar-modes="webxr scene-viewer quick-look"
            camera-controls
            auto-rotate
            shadow-intensity="1"
            shadow-softness="1"
            exposure="1"
            interaction-prompt="none"
            ar-placement="floor"
            ar-scale="fixed"
            loading="eager"
            style="width: 100%; height: 70vh; background-color: #ffffff;">

            <!-- Hotspots -->
            <button class="hotspot" slot="hotspot-1" data-position="1 1.5 1" data-normal="1 0 0" data-visibility-attribute="visible">
                <div class="hotspot-dot"></div>
                <div class="hotspot-label">Tela OLED</div>
            </button>

            <button class="hotspot" slot="hotspot-2" data-position="-1 1 1" data-normal="-1 0 0" data-visibility-attribute="visible">
                <div class="hotspot-dot"></div>
                <div class="hotspot-label">Bateria</div>
            </button>

            <button class="hotspot" slot="hotspot-3" data-position="0 2 1" data-normal="0 1 0" data-visibility-attribute="visible">
                <div class="hotspot-dot"></div>
                <div class="hotspot-label">Câmara de Aquecimento</div>
            </button>

            <button slot="ar-button" id="ar-button" class="ar-button">
                Ver em AR
            </button>

            <div class="progress-bar hide" slot="progress-bar">
                <div class="update-bar"></div>
            </div>

            <!-- Dicas de uso -->
            <div class="ar-prompt">
                <p id="ar-prompt-text">Carregando modelo...</p>
            </div>
        </model-viewer>

        <div class="controls">
            <button id="rotate-left">⟲ Girar Esquerda</button>
            <button id="rotate-right">⟳ Girar Direita</button>
            <button id="zoom-in">+ Aproximar</button>
            <button id="zoom-out">- Afastar</button>
        </div>
    </div>

    <script>
        // Dados dos hotspots
        const hotspotData = {
            'hotspot-1': {
                title: 'Tela OLED',
                description: 'Tela OLED de alta resolução que mostra o status do dispositivo, nível de bateria e configurações.'
            },
            'hotspot-2': {
                title: 'Bateria',
                description: 'Bateria de longa duração que permite várias sessões de uso. Recarregável via USB-C.'
            },
            'hotspot-3': {
                title: 'Câmara de Aquecimento',
                description: 'Tecnologia de aquecimento avançada que garante uma experiência consistente.'
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            const modelViewer = document.querySelector('model-viewer');
            const arButton = document.getElementById('ar-button');
            const arButtonIOS = document.getElementById('ar-button-ios');
            const errorMessage = document.getElementById('error-message');
            const arPromptText = document.getElementById('ar-prompt-text');
            const hotspotInfo = document.getElementById('hotspot-info');
            const hotspotTitle = document.getElementById('hotspot-title');
            const hotspotDescription = document.getElementById('hotspot-description');
            
            // Configurar hotspots
            const hotspots = document.querySelectorAll('.hotspot');
            hotspots.forEach(hotspot => {
                hotspot.addEventListener('click', () => {
                    const slotName = hotspot.getAttribute('slot');
                    const data = hotspotData[slotName];
                    if (data) {
                        hotspotTitle.textContent = data.title;
                        hotspotDescription.textContent = data.description;
                        hotspotInfo.style.display = 'block';
                    }
                });
            });

            // Fechar painel de informações
            window.closeHotspotInfo = function() {
                hotspotInfo.style.display = 'none';
            };
            
            // Detectar iOS
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            
            if (isIOS) {
                // Configurar botão AR para iOS
                arButtonIOS.style.display = 'block';
                arPromptText.textContent = 'Toque no botão azul para iniciar AR no iOS';
                
                arButtonIOS.addEventListener('click', function() {
                    try {
                        const anchor = document.createElement('a');
                        anchor.setAttribute('rel', 'ar');
                        anchor.appendChild(document.createElement('img'));
                        const modelUrl = 'https://websserver.github.io/modalviewer/modelo3d/modelo.usdz';
                        anchor.setAttribute('href', modelUrl);
                        anchor.click();
                    } catch (error) {
                        console.error('Erro ao abrir AR no iOS:', error);
                        errorMessage.style.display = 'block';
                        errorMessage.querySelector('p').textContent = 
                            'Erro ao abrir AR no iOS. Certifique-se de estar usando Safari.';
                    }
                });
            } else {
                arPromptText.textContent = 'Toque no botão verde para iniciar AR';
            }

            // Verificar suporte a AR
            if (modelViewer) {
                modelViewer.addEventListener('ar-status', (event) => {
                    if (event.detail.status === 'failed') {
                        console.error('Falha ao iniciar AR:', event.detail.error);
                        errorMessage.style.display = 'block';
                        errorMessage.querySelector('p').textContent = 
                            'Não foi possível iniciar o AR. Verifique se seu dispositivo suporta AR.';
                    }
                });

                modelViewer.addEventListener('load', () => {
                    console.log('Modelo carregado com sucesso');
                    arPromptText.textContent = isIOS ? 
                        'Toque no botão azul para iniciar AR no iOS' : 
                        'Toque no botão verde para iniciar AR';
                });

                modelViewer.addEventListener('error', (error) => {
                    console.error('Erro ao carregar modelo:', error);
                    errorMessage.style.display = 'block';
                    if (isIOS) {
                        errorMessage.querySelector('p').textContent = 
                            'Erro ao carregar o modelo 3D. Verifique sua conexão e tente novamente.';
                    }
                });
            }
        });
    </script>
</body>
</html> 